<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Streams</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.10.7/brython.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.10.7/brython_stdlib.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: #1a1a1a;
            color: white;
        }
        
        /* Модальное окно согласия */
        .consent-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .consent-box {
            background: #333;
            padding: 2rem;
            border-radius: 10px;
            max-width: 500px;
            text-align: center;
        }
        
        .consent-btn {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* Боковое меню */
        .sidebar {
            position: fixed;
            left: -300px;
            top: 0;
            width: 300px;
            height: 100%;
            background: #222;
            transition: 0.3s;
            padding: 20px;
            overflow-y: auto;
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .menu-btn {
            position: fixed;
            left: 20px;
            top: 20px;
            font-size: 24px;
            cursor: pointer;
            z-index: 100;
            background: #333;
            padding: 10px;
            border-radius: 5px;
        }
        
        /* Список игр */
        .game-list {
            margin-top: 20px;
        }
        
        .game-item {
            background: #444;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.2s;
        }
        
        .game-item:hover {
            background: #555;
        }
        
        /* Полноэкранный режим */
        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 999;
            display: none;
        }
        
        .exit-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            background: #ff3333;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1001;
        }
        
        /* Футер */
        footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            padding: 1rem;
            background: #222;
            text-align: center;
        }
        
        .links a {
            color: #4dabf7;
            margin: 0 10px;
            text-decoration: none;
        }
    </style>
</head>
<body onload="brython()">
    <!-- Модальное окно согласия -->
    <div class="consent-modal" id="consentModal">
        <div class="consent-box">
            <h2>Внимание!</h2>
            <p>Все Python-скрипты выполняются непосредственно в вашем браузере. Для работы требуется JavaScript.</p>
            <p>Нажимая "Согласиться", вы подтверждаете, что понимаете это.</p>
            <button class="consent-btn" onclick="acceptConsent()" style="background: #4CAF50;">Согласиться</button>
            <button class="consent-btn" onclick="declineConsent()" style="background: #f44336;">Отказаться</button>
        </div>
    </div>

    <!-- Кнопка меню -->
    <div class="menu-btn" onclick="toggleSidebar()">☰ Меню</div>

    <!-- Боковое меню -->
    <div class="sidebar" id="sidebar">
        <h2>Доступные Python-скрипты</h2>
        <div class="game-list" id="gameList">
            <!-- Игры будут загружены здесь -->
        </div>
    </div>

    <!-- Контейнер для игр -->
    <div class="fullscreen" id="gameContainer"></div>

    <!-- Футер -->
    <footer>
        <h3>Python Streams</h3>
        <p>Запуск Python-кода прямо в вашем браузере</p>
        <div class="links">
            <a href="https://github.com/yourusername" target="_blank">GitHub</a>
            <a href="https://twitter.com/yourusername" target="_blank">Twitter</a>
        </div>
    </footer>

    <script>
        // Обработка согласия
        function acceptConsent() {
            localStorage.setItem('pythonConsent', 'true');
            document.getElementById('consentModal').style.display = 'none';
            loadGames();
        }

        function declineConsent() {
            window.location.href = 'https://google.com';
        }

        // Проверка согласия при загрузке
        if(localStorage.getItem('pythonConsent') === 'true') {
            document.getElementById('consentModal').style.display = 'none';
        }

        // Меню
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Загрузка списка игр
        async function loadGames() {
            const container = document.getElementById('gameList');
            
            try {
                // Вместо файла list.json просто используем список файлов
                const games = [
                    {name: "Демо-игра: Шарики", file: "game1.py"},
                    {name: "Демо-игра: Квадраты", file: "game2.py"}
                ];

                games.forEach(game => {
                    const div = document.createElement('div');
                    div.className = 'game-item';
                    div.innerHTML = `<h3>${game.name}</h3>`;
                    div.onclick = () => launchGame(game.file);
                    container.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading games:', error);
                container.innerHTML = '<p>Не удалось загрузить список игр</p>';
            }
        }

        // Запуск игры
        async function launchGame(filename) {
            const container = document.getElementById('gameContainer');
            container.style.display = 'block';
            container.innerHTML = `
                <button class="exit-btn" onclick="exitFullscreen()">✕ Закрыть</button>
                <div id="python-container"></div>
            `;
            
            try {
                const response = await fetch(`/games/${filename}`);
                const code = await response.text();
                
                const pythonContainer = document.createElement('div');
                pythonContainer.id = 'python-script';
                container.appendChild(pythonContainer);
                
                pythonContainer.innerHTML = `
                    <script type="text/python">
                        ${code}
                    <\/script>
                `;
                
                brython(1);
            } catch (error) {
                console.error('Error loading game:', error);
                container.innerHTML = `
                    <button class="exit-btn" onclick="exitFullscreen()">✕ Закрыть</button>
                    <p style="color: white; padding: 20px;">Ошибка загрузки скрипта: ${error.message}</p>
                `;
            }
        }

        function exitFullscreen() {
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('gameContainer').innerHTML = '';
        }

        // Инициализация
        if(localStorage.getItem('pythonConsent') === 'true') {
            window.onload = loadGames;
        }
    </script>
</body>
</html>